Bootstrap: docker
From: ubuntu:24.04

%environment
  export LC_ALL=C.utf8          
  export PYTHONNOUSERSITE=True  # Disable user's local python modules in ~/.local
  export PATH="/opt/local/modkit:$PATH"

%post
  export LC_ALL=C.utf8
  export PYTHONNOUSERSITE=True
  export DEBIAN_FRONTEND=noninteractive

  # apt packages cached in /tmp
  mkdir -p /tmp/apt24 &&  echo "Dir::Cache "/tmp/apt24";" > /etc/apt/apt.conf.d/singularity-cache.conf

  apt-get update && apt-get -y dist-upgrade && \
  apt-get install -y git wget


  # Download
  export TMPD=/tmp/downloads &&   mkdir -p $TMPD
  wget -P $TMPD -c "https://github.com/nanoporetech/modkit/releases/download/v0.5.1-rc1/modkit_v0.5.1rc1_u16_x86_64.tar.gz"

  mkdir -p /opt/local/modkit
  tar -C /opt/local/modkit --strip-components 1 -xzf $TMPD/modkit_v0.5.1rc1_u16_x86_64.tar.gz


%runscript
#!/bin/sh
  if command -v $SINGULARITY_NAME > /dev/null 2> /dev/null; then
    exec $SINGULARITY_NAME "$@"
  else
    echo "# ERROR !!! Command $SINGULARITY_NAME not found in the container"
  fi
